.. _chap-theory:

.. Latex macros definitions used in this document
.. math::
    \renewcommand{\vec}[1]{\mathbf{#1}}
    \newcommand{\x}{\vec{x}}
    \newcommand{\xs}{\x_\text{s}}
    \newcommand{\xref}{\x_\text{ref}}
    \newcommand{\k}{\vec{k}}
    \newcommand{\n}{\vec{n}}
    \def \twoD {{2\text{D}}\,}
    \def \twohalfD {{2.5\text{D}}\,}
    \def \threeD {{3\text{D}}\,}


Mathematical fundamentals of sound field synthesis
==================================================

.. _sec-mathematical-definitions:

Mathematical Definitions
------------------------

.. _sec-coordinate_system:

Coordinate system
~~~~~~~~~~~~~~~~~

Figure shows the coordinate system that is used in the following
chapters. A vector :math:`\mathbf{x}` can be described by its position
:math:`(x,y,z)` in space or by its length, azimuth angle
:math:`\phi \in [0,2{\pi}[`, and elevation
:math:`\theta \in \left[-\frac{{\pi}}{2},\frac{{\pi}}{2}\right]`.
The azimuth is measured counterclockwise and elevation is positive for
positive :math:`z`-values.

.. _fig-coordinate-system:

.. figure:: fig01/coordinate_system.png
    :align: center

    Coordinate system used in this document. The vector :math:`x` can also be
    described by its length, its azimuth angle :math:`\phi`, and its elevation
    :math:`\theta`.

.. _sec-fourier-transform:

Fourier transformation
~~~~~~~~~~~~~~~~~~~~~~

Let :math:`s` be an absolute integrable function, :math:`t,\omega` real
numbers, then the temporal Fourier transform is defined after [Bracewell2000]_
as

.. math::
    :label: fft

    S(\omega) = {\mathcal{F}\left\{s(t)\right\}} =
        \int^{\infty}_{-\infty} s(t) {\mathrm{e}}^{-{\mathrm{i}}\omega t} \;
        {\mathop{\mathrm{d}{t}}} \;.

In the same way the inverse temporal Fourier transform is defined as

.. math::
    :label: ifft

    s(t) = {\mathcal{F}^{-1}\left\{S(\omega)\right\}} =
        \frac{1}{2{\pi}} \int^{\infty}_{-\infty} S(\omega)
        {\mathrm{e}}^{{\mathrm{i}}\omega t} \;
        {\mathop{\mathrm{d}{\omega}}} \;.


.. ============================================================================


.. _sec-problem-statement:

Problem statement
-----------------

.. _fig-geometry:

.. figure:: fig02/geometry.png
    :align: center

    Illustration of the geometry used to discuss the physical fundamentals of
    sound field synthesis and the single-layer potential.

The problem of sound field synthesis can be formulated after as follows. Assume
a volume :math:`V \subset \mathbb{R}^n` which is free of any sources and sinks,
surrounded by a distribution of monopole sources on its surface :math:`\partial
V`. The pressure :math:`P(\x,\omega)` at a point :math:`\x\in V` is then given
by the *single-layer potential* (compare p. 39 in [ColtonKress1998]_)

.. math::
    :label: single-layer

    P(\x,\omega) = \oint_{\partial V} D(\x_0,\omega) G(\x-\x_0,\omega) \;
    {\mathop{\mathrm{d}{A}}}(\x_0) \;,

where :math:`G(\x-\x_0,\omega)` denotes the sound propagation of the source at
location :math:`\x_0 \in \partial V`, and :math:`D(\x_0,\omega)` its weight,
usually referred to as *driving function*. The sources on the surface are called
*secondary sources* in sound field synthesis, analogue to the case of acoustical
scattering problems. The single-layer potential can be derived from the
Kirchhoff-Helmholtz integral [Williams1999]_. The challenge in sound field
synthesis is to solve the integral with respect to :math:`D(\x_0,\omega)` for a
desired sound field :math:`P = S` in :math:`V`. It has unique solutions which
[ZotterSpors2013]_ explicitly showed for the spherical case and [Fazi2010]_
(Chap.4.3) for the planar case.

In the following the single-layer potential for different dimensions is
discussed. An approach to formulate the desired sound field :math:`S` is
described and finally it is shown how to derive the driving function
:math:`D`.


.. ============================================================================


.. _sec-nfchoa:

Solution for Special Geometries: |NFC-HOA| and |SDM|
----------------------------------------------------

The integral equation  states a Fredholm equation of first kind with a Green’s
function as kernel. This type of equation can be solved in a straightforward
manner for geometries that have a complete set of orthogonal basis functions.
Then the involved functions are expanded into the basis functions :math:`\psi_n`
as [MorseFeshbach1981]_, eq. (940)

.. math::
    :label: G_expansion

    G(\x-\x_0,\omega) = \sum_{n=1}^N \tilde{G}_n(\omega) \,
        \psi_n^*(\x_0) \psi_n(\x)

.. math::
    :label: D_expansion

    D(\x_0,\omega) = \sum_{n=1}^N \tilde{D}_n(\omega) \,
        \psi_n(\x_0)

.. math::
    :label: S_expansion

    S(\x,\omega) = \sum_{n=1}^N \tilde{S}_n(\omega) \,
        \psi_n(\x) \;,

where :math:`\tilde{G}_n, \tilde{D}_n, \tilde{S}_n` denote the series expansion
coefficients and \ :math:`\langle\psi_n, \psi_{n'}\rangle = 0` for :math:`n \ne
n'`. Introducing these three equations into :eq:`single-layer` one gets

.. math::
    :label: D_HOA

    \tilde{D}_n(\omega) =
        \frac{\tilde{S}_n(\omega)}{\tilde{G}_n(\omega)} \;.

This means that the Fredholm equation  states a convolution. For geometries
where the required orthogonal basis functions exist, follows directly via the
convolution theorem [ArfkenWeber2005]_ (1013).  Due to the division of the
desired sound field by the spectrum of the Green’s function this kind of
approach has been named |SDM| [AhrensSpors2010]_.  For circular and spherical
geometries the term |NFC-HOA| is more common due to the corresponding basis
functions. “Near-field compensated” highlights the usage of point sources as
secondary sources in contrast to Ambisonics and |HOA| that assume plane waves as
secondary sources.

The challenge is to find a set of basis functions for a given geometry.
In the following paragraphs three simple geometries and their widely
known sets of basis functions will be discussed.

.. _sec-spherical-geometries:

Spherical Geometries
~~~~~~~~~~~~~~~~~~~~

The spherical harmonic functions constitute a basis for a spherical secondary
source distribution in :math:`{\mathbb{R}}^3` and can be defined as
[GumerovDuraiswami2004]_ (12.153), note that :math:`\sin\theta` is used here
instead of :math:`\cos\theta` due to the use of another coordinate system,
compare Figure 2.1 from Gumerov and Duraiswami and
:numref:`fig-coordinate-system`:

.. math::
    :label: spherical-harmonics

    \begin{gathered}
        Y_n^m(\theta,\phi) = (-1)^m \sqrt{\frac{(2n+1)(n-|m|)!}{4{\pi}(n+|m|)!}}
        P_n^{|m|}(\sin\theta) {\mathrm{e}}^{{\mathrm{i}}m\phi} \; \\
        n = 0,1,2,... \;\;\;\;\;\; m = -n,...,n
    \end{gathered}

where :math:`P_n^{|m|}` are the associated Legendre functions. Note that
this function may also be defined in a slightly different way, omitting
the :math:`(-1)^m` factor, see for example [Williams1999]_ (6.20).

The complex conjugate of :math:`Y_n^m` is given by negating the degree
:math:`m` as

.. math::
    :label: spherical-harmonics-complex-conjugate

    Y_n^m(\theta,\phi)^* = Y_n^{-m}(\theta,\phi) \;.

For a spherical secondary source distribution with a radius of :math:`R_0` the
sound field can be calculated by a convolution along the surface. The driving
function is then given by a simple division as [Ahrens2012]_ (3.21, note the
:math:`\frac{1}{2{\pi}}` term is wrong in (3.21) and omitted here, compare the
`errata <http://www.soundfieldsynthesis.org/errata/>`_ and [SchultzSpors2014]_
(24)):

.. math::
    :label: D_spherical

    \begin{gathered}
        D_\text{spherical}(\theta_0,\phi_0,\omega) = \\
        \frac{1}{R_0^{\,2}}
        \sum_{n=0}^\infty \sum_{m=-n}^n \sqrt{\frac{2n+1}{4{\pi}}}
        \frac{\breve{S}_n^m(\theta_\text{s},\phi_\text{s},r_\text{s},\omega)}
        {\breve{G}_n^0(\frac{{\pi}}{2},0,\omega)} Y_n^m(\theta_0,\phi_0) \;,
    \end{gathered}

where :math:`\breve{S}_n^m` denote the spherical expansion coefficients of the
source model, :math:`\theta_\text{s}` and :math:`\phi_\text{s}` its directional
dependency, and :math:`\breve{G}_n^0` the spherical expansion coefficients of a
secondary point source that is located at the north pole of the sphere with
:math:`\x_0 = (0,0,R_0)` and is given as [SchultzSpors2014]_ (25)

.. math::
    :label: G_spherical

    \breve{G}_n^0(\tfrac{{\pi}}{2},0,\omega) =
        -{\mathrm{i}}\frac{\omega}{c}\sqrt{\frac{2n+1}{4{\pi}}}
        {\,h_{n}^{(2)}\!}\left(\frac{\omega}{c}R_0\right) \;,

where :math:`{\,h_{n}^{(2)}\!}` describes the spherical Hankel function of
:math:`n`-th order and second kind.

.. _sec-circular-geometries:

Circular Geometries
~~~~~~~~~~~~~~~~~~~

The following functions build a basis in :math:`\mathbb{R}^2` for a circular
secondary source distribution [Williams1999]_

.. math::
    :label: circular-harmonics

    \Phi_m(\phi) = {\mathrm{e}}^{{\mathrm{i}}m\phi} \;.

The complex conjugate of :math:`\Phi_m` is given by negating the degree
:math:`m` as

.. math::
    :label: circular-harmonics-complex-conjugate

    \Phi_m(\phi)^* = \Phi_{-m}(\phi) \;.

For a circular secondary source distribution with a radius of :math:`R_0` the
driving function can be calculated by a convolution along the surface of the
circle as explicitly shown by [AhrensSpors2009a]_ and is then given as

.. math::
    :label: D_circular

    D_\text{circular}(\phi_0,\omega) =
        \frac{1}{2{\pi}R_0} \sum_{m=-\infty}^\infty
        \frac{\breve{S}_m(\phi_\text{s},r_\text{s},\omega)}
        {\breve{G}_m(0,\omega)} \, \Phi_m(\phi_0) \;,

where :math:`\breve{S}_m` denotes the circular expansion coefficients for the
source model, :math:`\phi_\text{s}` its directional dependency, and
:math:`\breve{G}_m` the circular expansion coefficients for a secondary line
source with

.. math::
    :label: G_circular

    \breve{G}_m(0,\omega) = -\frac{{\mathrm{i}}}{4}
        {\,H_{m}^{(2)}\!}\left(\frac{\omega}{c}R_0\right) \;,

where :math:`{\,H_{m}^{(2)}\!}` describes the Hankel function of :math:`m`-th
order and second kind.

.. _sec-planar-goemetries:

Planar Geometries
~~~~~~~~~~~~~~~~~

The basis functions for a planar secondary source distribution located
on the :math:`xz`-plane in :math:`\mathbb{R}^3` are given as

.. math::
    :label: planar-harmonics

    \Lambda(k_x,k_z,x,z) = {\mathrm{e}}^{-{\mathrm{i}}(k_x x + k_z z)} \;,

where :math:`k_x`, :math:`k_z` are entries in the wave vector :math:`\k` with
:math:`k^2 = (\frac{\omega}{c})^2`. The complex conjugate is given by negating
:math:`k_x` and :math:`k_z` as

.. math::
    :label: planar-harmonics-complex-conjugate

    \Lambda(k_x,k_z,x,z)^* = \Lambda(-k_x,-k_z,x,z) \;.

For an infinitely long secondary source distribution located on the
:math:`xz`-plane the driving function can be calculated by a two-dimensional
convolution along the plane as [Ahrens2012]_ (3.65)

.. math::
    :label: D_planar

    D_\text{planar}(x_0,\omega) = \frac{1}{4{\pi}^2} \iint_{-\infty}^\infty
       \frac{\breve{S}(k_x,y_\text{s},k_z,\omega)}{\breve{G}(k_x,0,k_z,\omega)}
       \Lambda(k_x,x_0,k_z,z_0) \, {\mathop{\mathrm{d}{k_x}}}
       {\mathop{\mathrm{d}{k_z}}} \;,

where :math:`\breve{S}` denotes the planar expansion coefficients for the source
model, :math:`y_\text{s}` its positional dependency, and :math:`\breve{G}` the
planar expansion coefficients of a secondary point source with
[SchultzSpors2014]_ (65)

.. math::
    :label: G_planar

    \breve{G}(k_x,0,k_z,\omega) = -\frac{{\mathrm{i}}}{2}
        \frac{1}{\sqrt{(\frac{\omega}{c})^2-k_x^2-k_z^2}} \;,

for :math:`(\frac{\omega}{c})^2 > (k_x^2+k_z^2)`.

For the planar and the following linear geometries the Fredholm equation is
solved for a non compact space :math:`V`, which leads to an infinite and
non-denumerable number of basis functions as opposed to the denumerable case for
compact spaces [SchultzSpors2014]_.

.. _sec-linear_geometries:

Linear Geometries
~~~~~~~~~~~~~~~~~

The basis functions for a linear secondary source distribution located on the
:math:`x`-axis are given as

.. math::
    :label: linear-harmonics

    \chi(k_x,x) = {\mathrm{e}}^{-{\mathrm{i}}k_x x} \;.

The complex conjugate is given by negating :math:`k_x` as

.. math::
    :label: linear-harmonics-complex-conjugate

    \chi(k_x,x)^* = \chi(-k_x,x) \;.

For an infinitely long secondary source distribution located on the
:math:`x`-axis the driving function for :math:`{\mathbb{R}}^2` can be calculated
by a convolution along this axis as (compare [Ahrens2012]_ (3.73))

.. math::
    :label: D_linear

    D_\text{linear}(x_0,\omega) = \frac{1}{2{\pi}} \int_{-\infty}^\infty
        \frac{\breve{S}(k_x,y_\text{s},\omega)}{\breve{G}(k_x,0,\omega)}
        \chi(k_x,x_0) \, {\mathop{\mathrm{d}{k_x}}} \;,

where :math:`\breve{S}` denotes the linear expansion coefficients for the source
model, :math:`y_\text{s}`, :math:`z_\text{s}` its positional dependency, and
:math:`\breve{G}` the linear expansion coefficients of a secondary line source
with

.. math::
    :label: G_linear

    \breve{G}(k_x,0,\omega) = -\frac{{\mathrm{i}}}{2}
        \frac{1}{\sqrt{(\frac{\omega}{c})^2-k_x^2}} \;,

for :math:`0<|k_x|<|\frac{\omega}{c}|`.


.. ============================================================================


.. _sec-wfs:

High Frequency Approximation: |WFS|
-----------------------------------

The single-layer potential  satisfies the homogeneous Helmholtz equation both in
the interior and exterior regions :math:`V` and :math:`V^*
{\mathrel{\!\mathop:}=}{\mathbb{R}}^n \setminus (V \cup \partial V)`. If
:math:`D(\x_0,\omega)` is continuous, the pressure :math:`P(\x,\omega)` is
continuous when approaching the surface :math:`\partial V` from the inside and
outside. Due to the presence of the secondary sources at the surface
:math:`\partial V`, the gradient of :math:`P(\x,\omega)` is discontinuous when
approaching the surface.  The strength of the secondary sources is then given by
the differences of the gradients approaching :math:`\partial V` from both sides
as [FaziNelson2013]_

.. math::
    :label: D_gradient

    D(\x_0,\omega) = \partial_\n P(\x_0,\omega) +
        \partial_{-\n} P(\x_0,\omega)\;,

where :math:`\partial_\n\!{\mathrel{\!\mathop:}=}\!\langle\nabla,\n\rangle` is
the directional gradient in direction :math:`\n` – see Figure. Due to the
symmetry of the problem the solution for an infinite planar boundary
:math:`\partial V` is given as

.. math::
    :label: D_wfs

    D(\x_0,\omega) = -2 \partial_\n S(\x_0,\omega) \;,

where the pressure in the outside region is the mirrored interior pressure given
by the source model :math:`S(\x,\omega)` for :math:`\x\in V`. The integral
equation resulting from introducing  into  for a planar boundary :math:`\partial
V` is known as *Rayleigh’s first integral equation*. This solution is identical
to the explicit solution for planar geometries  in :math:`{\mathbb{R}}^3` and
for linear geometries  in :math:`{\mathbb{R}}^2`.

A solution of  for arbitrary boundaries can be found by applying the *Kirchhoff*
or *physical optics approximation* [ColtonKress1983]_, page 53–54.  In acoustics
this is also known as *determining the visible elements* for the high frequency
boundary element method [Herrin2003]_.  Here, it is assumed that a bent surface
can be approximated by a set of small planar surfaces for which  holds locally.
In general, this will be the case if the wave length is much smaller than the
size of a planar surface patch and the position of the listener is far away from
the secondary sources, compare the assumptions made before (15) in
[SporsZotter2013]_, which lead to the derivation of the same window function in
a more explicit way. Additionally, only one part of the surface is active: the
area that is illuminated from the incident field of the source model. With this
approximation also non-convex secondary source distributions can be used with
|WFS| – compare Figure and appendix in [LaxFeshbach1947]_. This was neglected in
most of the literature so far, which postulates convex secondary source
distributions, e.g. [Spors2008]_.

The outlined approximation can be formulated by introducing a window function
:math:`w(\x_0)` for the selection of the active secondary sources into  as

.. math::
    :label: P_wfs

    P(\x,\omega) \approx \oint_{\partial V} \!\!  G(\x|\x_0,\omega) \,
        \underbrace{-2 w(\x_0) \partial_\n S(\x_0,\omega)}_{D(\x_0,\omega)} \;
        {\mathop{\mathrm{d}{A}}}(\x_0) \;.

One of the advantages of the applied approximation is that due to its local
character the solution of the driving function  does not depend on the geometry
of the secondary sources. This dependency applies to the direct solutions
presented in Section.

.. _fig-geometry:

.. figure:: fig03/placeholder.png
    :align: center

    Sound pressure of a point source synthesized with WFS :eq:`D.wfs.ps.2.5D`.
    The secondary source distribution is shown in black, whereby inactive
    sources are marked with a dashed line. Parameters: :math:`\xs = (0, 2.5, 0)`
    m, :math:`\xref = (0,−3, 0)` m, :math:`f = 700` Hz.


.. ============================================================================


.. _sec-dimensionality:

Sound Field Dimensionality
--------------------------

The single-layer potential  is valid for all :math:`V \subset {\mathbb{R}}^n`.
Consequentially, for practical applications a two-dimensional () as well as a
three-dimensional () synthesis is possible. Two-dimensional is not referring to
a synthesis in a plane only, but describes a setup that is independent of one
dimension. For example, an infinite cylinder is independent of the dimension
along its axis. The same is true for secondary source distributions in
synthesis.  They exhibit line source characteristics and are aligned in parallel
to the independent dimension. Typical arrangements of such secondary sources are
a circular or a linear setup.

The characteristics of the secondary sources limit the set of possible sources
which can be synthesized. For example, when using a secondary source setup it is
not possible to synthesize the amplitude decay of a point source.

For a synthesis the involved secondary sources depend on all dimensions and
exhibit point source characteristics. In this scenario classical secondary
sources setups would be a sphere or a plane.

.. _sec-25d-synthesis:

2.5D Synthesis
~~~~~~~~~~~~~~

.. _fig-geometry:

.. figure:: fig04/sound_field_dimensionality.png
    :align: center

    Sound pressure in decibel for secondary source distributions with different
    dimensionality all driven by the same signals. The sound pressure is color
    coded, lighter color corresponds to lower pressure. In the 3D case a pla-
    nar distribution of point sources is ap- plied, in the 2.5D case a linear
    distribu- tion of point sources, and in the 2D case a linear distribution of
    line sources.

In practice, the most common setups of secondary sources are setups, employing
cabinet loudspeakers. A cabinet loudspeaker does not show the characteristics of
a line source, but of a point source. This dimensionality mismatch prevents
perfect synthesis within the desired plane. The combination of a secondary
source setup with secondary sources that exhibit characteristics has led to
naming such configurations *synthesis* [Start1997]_. Such scenarios are
associated with a wrong amplitude decay due to the inherent mismatch of
secondary sources as is highlighted in Figure. In general, the amplitude is only
correct at a given reference point :math:`\xref`.

For a circular secondary source distribution with point source characteristic
the driving function can be derived by introducing expansion coefficients for
the spherical case into the driving function . The equation is than solved for
:math:`\theta = 0{^\circ}` and :math:`r_\text{ref} = 0`. This results in a
driving function given in [Ahrens2012]_ (3.49) as

.. math::
    :label: D_circular_25D

    D_{\text{circular},\twohalfD}(\phi_0,\omega) = \frac{1}{2{\pi}R_0}
        \sum_{m=-\infty}^\infty \frac{\breve{S}_{|m|}^m
        (\frac{{\pi}}{2},\phi_\text{s},r_\text{s},\omega)}{\breve{G}_{|m|}^m
       (\frac{{\pi}}{2},0,\omega)} \Phi_m(\phi_0) \;.

For a linear secondary source distribution with point source characteristics the
driving function is derived by introducing the linear expansion coefficients for
a monopole source  into the driving function  and solving the equation for
:math:`y = y_\text{ref}` and :math:`z = 0`. This results in a driving function
given as [Ahrens2012]_ (3.77)

.. math::
    :label: D_linear_25D

    D_{\text{linear},\twohalfD}(x_0,\omega) = \frac{1}{2{\pi}}
        \int_{-\infty}^\infty \frac{\breve{S}(k_x,y_\text{ref},0,\omega)}
        {\breve{G}(k_x,y_\text{ref},0,\omega)} \chi(k_x,x_0) \,
        {\mathop{\mathrm{d}{k_x}}} \;.

A driving function for the situation in the context of |WFS| and arbitrary
geometries of the secondary source distribution can be achieved by applying the
far-field approximation [Williams1999]_ (4.23).  :math:`{\,H_{0}^{(2)}\!}(\zeta)
\approx \sqrt{\frac{2{\mathrm{i}}}{{\pi}\zeta}}
{\mathrm{e}}^{-{\mathrm{i}}\zeta}` for :math:`\zeta \gg 1` to the Green’s
function. Using this the following relationship between the and Green’s
functions can be established.

.. math::
    :label: 25D_approximation

    \begin{gathered}
        \underbrace{-\frac{{\mathrm{i}}}{4} \;{\,H_{0}^{(2)}\!}
            \left(\frac{\omega}{c}|\x-\x_0|\right)}_{G_\twoD(\x-\x_0,\omega)}
        \approx
        \sqrt{2{\pi}\frac{c}{{\mathrm{i}}\omega} |\x-\x_0|} \;
        \underbrace{
            \frac{1}{4 {\pi}}
            \frac{{\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}|\x-\x_0|}}
            {|\x-\x_0|}}_{G_\threeD(\x-\x_0,\omega)} \;,
    \end{gathered}

where :math:`{\,H_{0}^{(2)}\!}` denotes the Hankel function of second kind and
zeroth order. Inserting this approximation into the single-layer potential for
the case results in

.. math::
    :label: single-layer_25D

    P(\x,\omega) = \oint_S \sqrt{2{\pi}\frac{c}{{\mathrm{i}}\omega}
        |\x-\x_0|} \; D(\x_0,\omega) G_\threeD(\x-\x0,\omega) \,
        {\mathop{\mathrm{d}{A}}}(\x_0) \;.

If the amplitude correction is further restricted to one reference point
:math:`\xref`, the driving function for |WFS| can be formulated as

.. math::
    :label: D25D_wfs

    D_\twohalfD(\x_0,\omega) = \underbrace{\sqrt{2{\pi}|\xref-\x_0|}}_{g_0}
        \sqrt{\frac{c}{{\mathrm{i}}\omega}} \, D(\x_0,\omega) \;,

where :math:`g_0` is independent of :math:`\x`.


.. ============================================================================


.. _model-based-rendering:

Model-Based Rendering
---------------------

Knowing the pressure field of the desired source :math:`S(\x,\omega)` is
required in order to derive the driving signal for the secondary source
distribution. It can either be measured, i.e. recorded, or modeled. While the
former is known as *data-based rendering*, the latter is known as *model-based
rendering*.  For data-based rendering, the problem of how to capture a complete
sound field still has to be solved. Avni et al. discuss some influences of the
recording limitations on the perception of the reproduced sound field
[Avni2013]_. This thesis focusses on the perception of the synthesis part.
Therefore it will consider only model-based rendering.

Frequently applied models in model-based rendering are plane waves, point
sources, or sources with a prescribed complex directivity. In the following the
models used within the Sound Field Synthesis Toolbox are presented.

.. _sec-plane-wave:

Plane Wave
~~~~~~~~~~

The source model for a plane wave is given as [Williams1999]_, (2.24, note that
Williams defines the Fourier transform with transposed signs as :math:`F(\omega)
= \int f(t) {\mathrm{e}}^{{\mathrm{i}}\omega t}`. This leads also to changed
signs in his definitions of the Green’s functions and field expansions.)

.. math::
    :label: S.pw

    S(\x,\omega) = A(\omega) {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}\n_k \x}
        \;,

where :math:`A(\omega)` denotes the frequency spectrum of the source and
:math:`\n_k` a unit vector pointing into the direction of the plane wave.

Transformed in the temporal domain this becomes

.. math::
    :label: s.pw

    s(\x,t) = a(t) * {\,\delta\!\left(t -\frac{\n_k \x}{c}\right)} \;,

where :math:`a(t)` is the Fourier transformation of the frequency spectrum
:math:`A(\omega)`.

The expansion coefficients for spherical basis functions are given as
[Ahrens2012]_ (2.38)

.. math::
    :label: plane-wave-spherical-coefficients

    \breve{S}_n^m(\theta_k,\phi_k,\omega) = 4{\pi}{\mathrm{i}}^{-n}
        Y_n^{-m}(\theta_k,\phi_k) \;,

where :math:`(\phi_k,\theta_k)` is the radiating direction of the plane wave.

In a similar manner the expansion coefficients for circular basis functions are
given as

.. math::
    :label: plane-wave-circular-coefficients

    \breve{S}_m(\phi_\text{s},\omega) = {\mathrm{i}}^{-n}
        \Phi_{-m}(\phi_\text{s}) \;.

The expansion coefficients for linear basis functions are given as after
[Ahrens2012]_ (C.5)

.. math::
    :label: plane-wave-linear-coefficients

    \breve{S}(k_x,y,\omega) = 2{\pi}{\,\delta\!\left(k_x-k_{x,\text{s}}\right)}
        \chi(k_{y,\text{s}},y) \;,

where :math:`(k_{x,\text{s}},k_{y,\text{s}})` points into the radiating
direction of the plane wave.

.. _sec-point-source:

Point Source
~~~~~~~~~~~~

The source model for a point source is given by the three dimensional Green’s
function as [Williams1999]_ (6.73)

.. math::
    :label: S.ps

    S(\x,\omega) = A(\omega) \frac{1}{4{\pi}} \frac{{\mathrm{e}}^{-{\mathrm{i}}
        \frac{\omega}{c}|\x-\xs|}}{|\x-\xs|} \;,

where :math:`\xs` describes the position of the point source.

Transformed to the temporal domain this becomes

.. math::
    :label: s.ps

    s(\x,t) = a(t) * \frac{1}{4{\pi}} \frac{1}{|\x-\xs|}
        {\,\delta\!\left(t - \frac{|\x-\xs|}{c}\right)} \;.

The expansion coefficients for spherical basis functions are given
as [Ahrens2012]_ (2.37)

.. math::
    :label: point-source-spherical-coefficients

    \breve{S}_n^m(\theta_\text{s},\phi_\text{s},r_\text{s},\omega) =
        -{\mathrm{i}}\frac{\omega}{c}\,
        h_n^{(2)}\!\!\left(\frac{\omega}{c}r_\text{s}\right)
        Y_n^{-m}(\theta_\text{s},\phi_\text{s}) \;,

where :math:`(\phi_\text{s},\theta_\text{s},r_\text{s})` describes the position
of the point source.

The expansion coefficients for linear basis functions are given as [Ahrens2012]_
(C.10)

.. math::
    :label: point-source-linear-coefficients

    \breve{S}(k_x,y,\omega) =
        -\frac{{\mathrm{i}}}{4} {\,H_{0}^{(2)}\!}
        \left( \sqrt{(\tfrac{\omega}{c})^2-k_x^2} \; |y-y_\text{s}| \right)
        \chi(-k_x,x_\text{s}) \;,

for :math:`|k_x|<|\frac{\omega}{c}|` and with :math:`(x_\text{s},y_\text{s})`
describing the position of the point source.

.. _sec-3d-dipole-source:

3D Dipole Source
~~~~~~~~~~~~~~~~

The source model for a three dimensional dipole source is given by the
directional derivative of the three dimensional Green’s function with respect to
:math:`{\n_\text{s}}` defining the orientation of the dipole source.

.. math::
    :label: S.dps

    \begin{aligned}
        S(\x,\omega) &= A(\omega)
            \left\langle
            \nabla_{\xs} \left( \frac{1}{4{\pi}} \frac{{\mathrm{e}}^{-{\mathrm{i}}
            \frac{\omega}{c}|\x-\xs|}}{|\x-\xs|} \right),
            {\n_\text{s}}\right\rangle \\
        &=
            A(\omega) \frac{1}{4{\pi}}
            \left( \frac{1}{|\x-\xs|} + {\mathrm{i}}\frac{\omega}{c}\right)
            \frac{\langle \x-\xs, {\n_\text{s}}\rangle}{|\x-\xs|^2}
            {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}|\x-\xs|} \;.
    \end{aligned}

Transformed to the temporal domain this becomes

.. math::
    :label: s.dps

    s(\x,t) = a(t) *
        \left( \frac{1}{|\x-\xs|} + {\mathcal{F}^{-1}\left\{
        \frac{{\mathrm{i}}\omega}{c} \right\}} \right) *
        \frac{\langle \x-\xs, {\n_\text{s}}\rangle}{4{\pi}|\x-\xs|^2}
        {\,\delta\!\left(t - \frac{|\x-\xs|}{c}\right)} \;.

.. _sec-line-source:

Line Source
~~~~~~~~~~~

The source model for a line source is given by the two dimensional Green’s
function as [Williams1999] (8.47)

.. math::
    :label: S.ls

    S(\x,\omega) = -A(\omega) \frac{{\mathrm{i}}}{4} {\,H_{0}^{(2)}\!}
        \left(\frac{\omega}{c}|\x-\xs|\right) \;.

Applying the large argument approximation of the Hankel function [Williams1999]_
(4.23)) and transformed to the temporal domain this becomes

.. math::
    :label: s.ls

    s(\x,t) = a(t) * {\mathcal{F}^{-1}\left\{\sqrt{
        \frac{c}{{\mathrm{i}}\omega}}\right\}} * \sqrt{\frac{1}{8{\pi}}}
        \frac{1}{\sqrt{|\x-\xs|}}
        {\,\delta\!\left(t - \frac{|\x-\xs|}{c}\right)} \;.

The expansion coefficients for circular basis functions are given as

.. math::
    :label: line-source-circular-coefficients

    \breve{S}_m(\phi_\text{s},r_\text{s},\omega) = -\frac{{\mathrm{i}}}{4}
        {\,H_{m}^{(2)}\!} \left(\frac{\omega}{c}r_\text{s}\right)
        \Phi_{-m}(\phi_\text{s}) \;.

The expansion coefficients for linear basis functions are given as

.. math::
    :label: line-source-linear-coefficients

    \breve{S}(k_x,y_\text{s},\omega) = -\frac{{\mathrm{i}}}{2}
        \frac{1}{\sqrt{(\frac{\omega}{c})^2-k_x^2}}
        \chi(k_y,y_\text{s})\;.


.. ============================================================================


.. _sec-driving-functions:

Driving Functions
-----------------

In the following, driving functions for Near-Field Compensated Higher Order
Ambisonics, the Spectral Division Method and Wave Field Synthesis are derived
for spherical, circular, and linear secondary source distributions. Among the
possible combinations of methods and secondary sources not all are meaningful.
Hence, only the relevant ones will be presented. The same holds for the
introduced source models of plane waves, point sources, line sources and focused
sources. [AhrensSpors2010]_ in addition have considered Spectral Division Method
driving functions for planar secondary source distributions.

The driving functions are given in the temporal-frequency domain. For some of
them, especially in the case of |WFS| an analytic solution in the temporal domain
exists and is presented. For |NFC-HOA|, temporal-domain implementations for the
cases are available for a plane wave and a point source as source models. The
derivation of the implementation is not explicitly shown here, but is described
in [Spors2011]_.

The cases are illustrated in the following by companion figures, because only
those cases will be investigated in the remainder of this thesis.

.. _sec-driving-functions-nfchoa-sdm:

Near-Field Compensated Higher Order Ambisonics and Spectral Division Method
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. _sec-driving-functions-nfchoa-sdm-plane-wave:

Plane Wave
''''''''''

For a spherical secondary source distribution with radius :math:`R_0` the
spherical expansion coefficients of a plane wave  and of the Green’s function
for a point source  are inserted into  and yield [SchultzSpors2014]_ (96)

.. math::
    :label: D.nfchoa.pw.3D

    D_\text{spherical}(\theta_0,\phi_0,\omega) = -A(\omega)
        \frac{4{\pi}}{R_0^{\,2}} \sum_{n=0}^\infty \sum_{m=-n}^n
        \frac{{\mathrm{i}}^{-n} Y_n^{-m}(\theta_k,\phi_k)}
        {\mathrm{i}\frac{\omega}{c}h_n^{(2)} \left(\frac{\omega}{c}R_0\right)}
        Y_n^m(\theta_0,\phi_0) \;.

For a circular secondary source distribution with radius :math:`R_0` the
circular expansion coefficients of a plane wave  and of the Green’s function for
a line source  are inserted into  and yield [AhrensSpors2009a]_ (16)

.. math::
    :label: D.nfchoa.pw.2D

    D_\text{circular}(\phi_0,\omega) = -A(\omega) \frac{2{\mathrm{i}}}{{\pi}R_0}
        \sum_{m=-\infty}^\infty \frac{{\mathrm{i}}^{-m}\Phi_{-m}(\phi_k)}
        {{\,H_{m}^{(2)}\!}(\frac{\omega}{c}R_0)} \Phi_m(\phi_0) \;.

For a circular secondary source distribution with radius :math:`R_0` and point
source as Green’s function the driving function is given by inserting the
spherical expansion coefficients for a plane wave  and a point source  into  as

.. math::
    :label: D.nfchoa.pw.2.5D

    D_{\text{circular},\,\twohalfD}(\phi_0,\omega) = -A(\omega) \frac{2}{R_0}
        \sum_{m=-\infty}^\infty \frac{{\mathrm{i}}^{-|m|} \Phi_{-m}(\phi_k)}
        {{\mathrm{i}}\frac{\omega}{c}h_{|m|}^{(2)}
        \left(\frac{\omega}{c}R_0\right)} \Phi_m(\phi_0) \;.

For an infinite linear secondary source distribution located on the
:math:`x`-axis the driving function is given by inserting the linear expansion
coefficients for a point source as Green’s function  and a plane wave  into  and
exploiting the fact that :math:`(\frac{\omega}{c})^2 - k_{x_\text{s}}` is
constant. Assuming :math:`0 \le |k_{x_\text{s}}| \le |\frac{\omega}{c}|` this
results in [AhrensSpors2010]_ (17)

.. math::
    :label: D.sdm.pw.2.5D

    D_{\text{linear},\,\twohalfD}(x_0,\omega) = A(\omega)
        \frac{4{\mathrm{i}}\chi(k_y,y_\text{ref})}
        {{\,H_{0}^{(2)}\!}(k_y y_\text{ref})} \chi(k_x,x_0) \;.

Transfered to the temporal domain this results in [AhrensSpors2010]_ (18)

.. math::
    :label: d.sdm.pw.2.5D

    d_{\text{linear},\,\twohalfD}(x_0,t) = h(t) *
        a(t-\frac{x_0}{c}\sin\phi_k-\frac{y_\text{ref}}{c}\sin\phi_k) \;,

where :math:`\phi_k` denotes the azimuth direction of the plane wave and

.. math::
    :label: h.sdm

    h(t) = {\mathcal{F}^{-1}\left\{\frac{4{\mathrm{i}}}
        {{\,H_{0}^{(2)}\!}(k_y y_\text{ref})}\right\}} \;.

The advantage of this result is that it can be implemented by a simple weighting
and delaying of the signal, plus one convolution with :math:`h(t)`. The same
holds for the driving functions of |WFS| as presented in the next section.

.. _sec-driving-functions-nfchoa-sdm-point-source:

Point Source
''''''''''''

For a spherical secondary source distribution with radius :math:`R_0` the
spherical coefficients of a point source  and of the Green’s function  are
inserted into  and yield

.. math::
    :label: D.nfchoa.ps.3D

    D_\text{spherical}(\theta_0,\phi_0,\omega) =
        A(\omega) \frac{1}{R_0^{\,2}} \sum_{n=0}^\infty \sum_{m=-n}^n
        \frac{h_n^{(2)}(\frac{\omega}{c}r_\text{s})
        Y_n^{-m}(\theta_\text{s},\phi_\text{s})}
        {h_n^{(2)}(\frac{\omega}{c}R_0)} Y_n^m (\theta_0,\phi_0) \;.

For a circular secondary source distribution with radius :math:`R_0` and point
source as secondary sources the driving function is given by inserting the
spherical coefficients  and  into  as

.. math::
    :label: D.nfchoa.ps.2.5D

    D_{\text{circular},\,\twohalfD}(\phi_0,\omega) =
        A(\omega) \frac{1}{2{\pi}R_0} \sum_{m=-\infty}^{\infty}
        \frac{h_{|m|}^{(2)} (\frac{\omega}{c}r_s) \Phi_{-m}(\phi_\text{s})}
        {h_{|m|}^{(2)} (\frac{\omega}{c}R_0)} \Phi_m(\phi_0) \;.

For an infinite linear secondary source distribution located on the
:math:`x`-axis and point sources as secondary sources the driving function for a
point source is given by inserting the corresponding linear expansion
coefficients  and  into . Assuming :math:`0 \le |k_x| < |\frac{\omega}{c}|` this
results in [Ahrens2012]_ (4.53)

.. math::
    :label: D.sdm.ps.2.5D

    D_{\text{linear},\,\twohalfD}(x_0,\omega) =
        A(\omega) \int_{-\infty}^\infty \frac{
        {\,H_{0}^{(2)}\!}\left(\sqrt{(\frac{\omega}{c})^2-k_x^2} \;
        (y_\text{ref}-y_\text{s}) \right) \chi(-k_x,x_\text{s})}
        {{\,H_{0}^{(2)}\!}\left(\sqrt{(\frac{\omega}{c})^2-k_x^2} \;
        y_\text{ref}\right)} \chi(k_x,x_0) \, {\mathop{\mathrm{d}{k_x}}} \;.

.. _sec-driving-functions-nfchoa-sdm-line-source:

Line Source
'''''''''''

For a circular secondary source distribution with radius :math:`R_0` and line
sources as secondary sources the driving function is given by inserting the
circular coefficients  and  into  as

.. math::
    :label: D.nfchoa.ls.2D

    D_{\text{circular}}(\phi_0,\omega) = A(\omega) \frac{1}{2{\pi}R_0}
        \sum_{m=-\infty}^{\infty} \frac{{\,H_{m}^{(2)}\!}(\frac{\omega}{c}r_s)
        \Phi_{-m}(\phi_\text{s})} {{\,H_{m}^{(2)}\!}(\frac{\omega}{c}R_0)}
        \Phi_m(\phi_0) \;.

For an infinite linear secondary source distribution located on the
:math:`x`-axis and line sources as secondary sources the driving function is
given by inserting the linear coefficients  and  into  as

.. math::
    :label: D.sdm.ls.2D

    D_\text{linear}(x_0,\omega) = A(\omega) \frac{1}{2{\pi}}
        \int_{-\infty}^\infty \chi(k_y,y_s) \chi(k_x,x_0) \,
        {\mathop{\mathrm{d}{k_x}}} \;.

.. _sec-driving-functions-nfchoa-sdm-focused-source:

Focused Source
''''''''''''''

Focused sources mimic point or line sources that are located inside the audience
area. For the single-layer potential the assumption is that the audience area is
free from sources and sinks. However, a focused source is neither of them. It
represents a sound field that converges towards a focal point and diverges
afterwards. This can be achieved by reversing the driving function of a point or
line source in time which is known as time reversal focusing [Yon2003]_.

Nonetheless, the single-layer potential should not be solved for focused sources
without any approximation. In the near field of a source, evanescent waves
[Williams1999]_ (24) appear for spatial frequencies :math:`k_x >
|\frac{\omega}{c}|`. They decay exponentially with the distance from the source.
An exact solution for a focused source is supposed to include these evanescent
waves around the focal point. That is only possible by applying very large
amplitudes to the secondary sources, compare Fig.2a in [SporsAhrens2010]_. Since
the evanescent waves decay rapidly and are hence not influencing the perception,
they can easily be omitted. For corresponding driving functions for focused
sources without the evanescent part of the sound field see [SporsAhrens2010]_
for |SDM| and [AhrensSpors2009b]_ for |NFC-HOA|.

In the SFS Toolbox only focused sources in |WFS| are considered at the moment.


.. _sec-driving-functions-wfs:

Wave Field Synthesis
~~~~~~~~~~~~~~~~~~~~

In the following, the driving functions for |WFS| in the frequency and temporal
domain for selected source models are presented. The temporal domain functions
consist of a filtering of the source signal and a weighting and delaying of the
individual secondary source signals. This property allows for a very efficient
implementation of |WFS| driving functions in the temporal domain. It is one of the
main advantages of |WFS| in comparison to most of the |NFC-HOA|, |SDM| solutions
discussed above.

.. _sec-driving-functions-wfs-plane-wave:

Plane Wave
''''''''''

By inserting the source model of a plane wave  into  and  it follows

.. math::
    :label: D.wfs.pw

    D(\x_0,\omega) = 2 w(\x_0) A(\omega)
        {\mathrm{i}}\frac{\omega}{c}\n_k\n_{\x_0}
        {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}\n_k\x_0} \;,

.. math::
    :label: D.wfs.pw.2.5D

    D_\twohalfD(\x_0,\omega) = 2g_0 w(\x_0) A(\omega)
        \sqrt{{\mathrm{i}}\frac{\omega}{c}} \n_k\n_{\x_0}
        {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}\n_k\x_0} \;.

Transfered to the temporal domain via an inverse Fourier transform , it follows

.. math::
    :label: d.wfs.pw

    d(\x_0,t) = 2 a(t) * h(t) * w(\x_0) \n_k \n_{\x_0} {\,\delta\!\left(t -
        \frac{\n_k\x_0}{c}\right)} \;,

.. math::
    :label: d.wfs.pw.2.5D

    d_\twohalfD(\x_0,t) = 2g_0 a(t) * h_\twohalfD(t) * w(\x_0) \n_k \n_{\x_0}
        {\,\delta\!\left(t - \frac{\n_k\x_0}{c}\right)} \;,

where

.. math::
    :label: h.wfs

    h(t) = {\mathcal{F}^{-1}\left\{{\mathrm{i}}\frac{\omega}{c}\right\}} \;,

and

.. math::
    :label: h.wfs.2.5D

    h_\twohalfD(t) = {\mathcal{F}^{-1}\left\{\sqrt{{\mathrm{i}}\frac{\omega}{c}}\right\}}

denote the so called pre-equalization filters in |WFS|.

The window function :math:`w(\x_0)` for a plane wave as source model can be
calculated after [Spors2008]_

.. math::
    :label: wfs.pw.selection

    w(\x_0) = 
        \begin{cases}
            1 & \n_k \n_{\x_0} > 0 \\
            0 & \text{else}
        \end{cases}

.. _sec-driving-functions-wfs-point-source:

Point Source
''''''''''''

By inserting the source model for a point source  into  and  it follows

.. math::
    :label: D.wfs.ps.woapprox

    D(\x_0,\omega) =
        \frac{1}{2{\pi}} A(\omega) w(\x_0) \left({\mathrm{i}}\frac{\omega}{c}+
        \frac{1}{|\x_0-\xs|} \right) \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^2}
        {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

.. math::
    :label: D.wfs.ps.woapprox.2.5D

    D_\twohalfD(\x_0,\omega) =
        \frac{g_0}{2{\pi}} A(\omega) w(\x_0) \sqrt{{\mathrm{i}}\frac{\omega}{c}}
        \left(1 + \frac{1}{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \right)
        \frac{(\x_0-\xs) \n_{\x_0}}{|\x_0-\xs|^2} {\mathrm{e}}^{-{\mathrm{i}}
        \frac{\omega}{c}|\x_0-\xs|} \;.

Under the assumption of :math:`|\x_0-\xs| \gg 1` and can be approximated by

.. math::
    :label: D.wfs.ps

    D(\x_0,\omega) = \frac{1}{2{\pi}} A(\omega) w(\x_0) {\mathrm{i}}
        \frac{\omega}{c}\frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

.. math::
    :label: D.wfs.ps.2.5D

    D_\twohalfD(\x_0,\omega) =
        \frac{g_0}{2{\pi}} A(\omega) w(\x_0) \sqrt{{\mathrm{i}}\frac{\omega}{c}}
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\mathrm{e}}^{-{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

which is the traditional formulation of a point source in |WFS| as given for the
case in [Verheijen1997]_ (2.22a), whereby :math:`r` corresponds to
:math:`|\x_0-\xs|` and :math:`\cos\varphi` to
:math:`\frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|}`) It has the advantage that its
temporal domain version could again be implemented as a simple weighting- and
delaying-mechanism. This is the default driving function for a point source in
the SFS Toolbox.

Transfered to the temporal domain via an inverse Fourier transform  it follows

.. math::
    :label: d.wfs.ps

    d(\x_0,t) = \frac{1}{2{\pi}} a(t) * h(t) * w(\x_0)
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t-\frac{|\x_0-\xs|}{c}\right)} \;,

.. math::
    :label: d.wfs.ps.2.5D

    d_\twohalfD(\x_0,t) =
        \frac{g_0}{2{\pi}} a(t) * h_\twohalfD(t) * w(\x_0)
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t-\frac{|\x_0-\xs|}{c}\right)} \;.

The window function :math:`w(\x_0)` for a point source as source model can be
calculated after [Spors2008]_.

.. math::
    :label: wfs.ps.selection

    w(\x_0) = 
        \begin{cases}
            1 & (\x_0-\xs) \n_{\x_0} > 0 \\
            0 & \text{else}
        \end{cases}

.. _sec-driving-functions-wfs-line-source:

Line Source
'''''''''''

By inserting the source model for a line source  into  and  and calculating the
derivate of the Hankel function [AbramowitzStegun1972]_ (9.1.30) it follows

.. math::
    :label: D.wfs.ls

    D(\x_0,\omega) = -\frac{1}{2}A(\omega) w(\x_0) {\mathrm{i}}\frac{\omega}{c}
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|}
        {\,H_{1}^{(2)}\!}\left(\frac{\omega}{c}|\x_0-\xs|\right) \;,

.. math::
    :label: D.wfs.ls.2.5D

    D_\twohalfD(\x_0,\omega) =
        -\frac{1}{2}g_0 A(\omega) w(\x_0) \sqrt{{\mathrm{i}}\frac{\omega}{c}}
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|}
        {\,H_{1}^{(2)}\!}\left(\frac{\omega}{c}|\x_0-\xs|\right) \;.

Applying :math:`{\,H_{1}^{(2)}\!}(\zeta) \approx
-\sqrt{\frac{2}{{\pi}{\mathrm{i}}\zeta}} {\mathrm{e}}^{-{\mathrm{i}}\zeta}` for
:math:`z\gg1` after [Williams1999]_ (4.23) and transfered to the temporal domain
via an inverse Fourier transform  it follows

.. math::
    :label: d.wfs.ls

    d(\x_0,t) = \sqrt{\frac{1}{2{\pi}}} a(t) * h(t) *
        w(\x0) \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t-\frac{|\x_0-\xs|}{c}\right)} \;,

.. math::
    :label: d.wfs.ls.2.5D

    d_\twohalfD(\x_0,t) =
        g_0 \sqrt{\frac{1}{2{\pi}}} a(t) *
        {    \mathcal{F}^{-1}\left\{\sqrt{\frac{c}
        {{\mathrm{i}}\omega}}\right\}} * w(\x0)
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t-\frac{|\x_0-\xs|}{c}\right)} \;.

The window function :math:`w(\x_0)` for a line source as source model can be
calculated after [Spors2008]_

.. math::
    :label: wfs.ls.selection

    w(\x_0) = 
        \begin{cases}
            1 & (\x_0-\xs) \n_{\x_0} > 0 \\
            0 & \text{else}
        \end{cases}

.. _sec-driving-functions-wfs-focused-source:

Focused Source
''''''''''''''

As mentioned before, focused sources exhibit a field that converges in a focal
point inside the audience area. After passing the focal point, the field becomes
a diverging one as can be seen in Figure . In order to choose the active
secondary sources, especially for circular or spherical geometries, the focused
source also needs a direction :math:`\n_\text{s}`.

The driving function for a focused source are given by the time-reversed
versions of the driving functions for a point source as

.. math::
    :label: D.wfs.fs.woapprox

    D(\x_0,\omega) =
        \frac{1}{2{\pi}} A(\omega) w(\x_0) \left({\mathrm{i}}\frac{\omega}{c}+
        \frac{1}{|\x_0-\xs|} \right) \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^2}
        {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

.. math::
    :label: D.wfs.fs.woapprox.2.5D

    D_\twohalfD(\x_0,\omega) =
        \frac{g_0}{2{\pi}} A(\omega) w(\x_0) \sqrt{{\mathrm{i}}\frac{\omega}{c}}
        \left(1 + \frac{1}{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \right)
        \frac{(\x_0-\xs) \n_{\x_0}}{|\x_0-\xs|^2}
        {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

or by using an approximated point source as

.. math::
    :label: D.wfs.fs

    D(\x_0,\omega) = \frac{1}{2{\pi}} A(\omega) w(\x_0) {\mathrm{i}}
        \frac{\omega}{c}\frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;,

.. math::
    :label: D.wfs.fs.2.5D

    D_\twohalfD(\x_0,\omega) = \frac{g_0}{2{\pi}} A(\omega) w(\x_0)
        \sqrt{{\mathrm{i}}\frac{\omega}{c}}
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|} \;.

As before for other source types, the approximated versions are the default
driving functions for a focused source used in the |SFS Toolbox|.

Transfered to the temporal domain via an inverse Fourier transform it follows

.. math::
    :label: d.wfs.fs

    d(\x_0,t) = \frac{1}{2{\pi}} a(t) * h(t) * w(\x_0)
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t+\frac{|\x_0-\xs|}{c}\right)} \;,

.. math::
    :label: d.wfs.fs.2.5D

    d_\twohalfD(\x_0,t) =
        \frac{g_0}{2{\pi}} a(t) * h_\twohalfD(t) * w(\x_0)
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
        {\,\delta\!\left(t+\frac{|\x_0-\xs|}{c}\right)} \;.

In this thesis a focused source always refers to the time-reversed version of a
point source, but a focused line source can be defined in the same way starting
from 

.. math::
    :label: D.wfs.fs.ls

    D(\x_0,\omega) = -\frac{1}{2}A(\omega) w(\x_0) {\mathrm{i}}\frac{\omega}{c}
        \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|}
        {\,H_{1}^{(1)}\!}\left(\frac{\omega}{c}|\x_0-\xs|\right) \;.

The window function :math:`w(\x_0)` for a focused source can be calculated as

.. math::
    :label: wfs.fs.selection

    w(\x_0) = 
        \begin{cases}
            1 & \n_\text{s} (\xs-\x_0) > 0 \\
            0 & \text{else}
        \end{cases}

.. _sec-driving-functions-local-sfs:

Local Sound Field Synthesis
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The reproduction accuracy of |WFS| is limited due to practical aspects.  For the
audible frequency range the desired sound field can not be synthesized
aliasing-free over an extended listening area, which is surrounded by a discrete
ensemble of individually driven loudspeakers.  However, it is suitable for
certain applications to increase reproduction accuracy inside a smaller (local)
listening region while stronger artifacts outside are permitted. The implemented
Local Wave Field Synthesis method utilizes focused sources as a distribution of
virtual loudspeakers which are placed more densely around the local listening
area. These virtual loudspeakers can be driven by conventional SFS techniques,
like e.g. |WFS| or |NFC-HOA|. The results are similar to band-limited |NFC-HOA|, with
the difference that the form and position of the enhanced area can freely be
chosen within the listening area.

The set of focused sources is treated as a virtual loudspeaker distribution and
their positions :math:`{\x_\text{fs}}` are subsumed under
:math:`\mathcal{X}_{\mathrm{fs}}`. Therefore, each focused source is driven
individually by :math:`D_\text{l}({\x_\text{fs}}, \omega)`, which in principle
can be any driving function for real loudspeakers mentioned in previous
sections. At the moment however, only |WFS| and |NFC-HOA| driving functions are
supported. The resulting driving function for a loudspeaker located at
:math:`\x_0` reads

.. math::
    :label: D.localwfs

    D(\x_0,\omega) = \sum_{{\x_\text{fs}}\in \mathcal{X}_{\mathrm{fs}}}
        D_{\mathrm l}({\x_\text{fs}}, \omega)
        D_{\mathrm{fs}}(\x_0,{\x_\text{fs}},\omega) \;,

which is superposition of the driving function
:math:`D_{\mathrm{fs}}(\x_0,{\x_\text{fs}},\omega)` reproducing a single focused
source at :math:`{\x_\text{fs}}` weighted by :math:`D_\text{l}({\x_\text{fs}},
\omega)`.  Former is derived by replacing :math:`\xs` with
:math:`{\x_\text{fs}}` in the |WFS| driving functions and for focused sources.
This yields

.. math::
    :label: D.localwfs.fs

    D_{\mathrm{fs}}(\x_0,{\x_\text{fs}},\omega) =
        \frac{1}{2{\pi}} A(\omega) w(\x_0) {\mathrm{i}}\frac{\omega}{c}
        \frac{(\x_0-{\x_\text{fs}})\n_{\x_0}}
        {|\x_0-{\x_\text{fs}}|^{\frac{3}{2}}}
        {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-{\x_\text{fs}}|}

and

.. math::
    :label: D.localwfs.fs.2.5D

    D_{\mathrm{fs,2.5D}}(\x_0,{\x_\text{fs}},\omega) = 
       \frac{g_0}{2{\pi}} A(\omega) w(\x_0) \sqrt{{\mathrm{i}}\frac{\omega}{c}}
       \frac{(\x_0-\xs)\n_{\x_0}}{|\x_0-\xs|^{\frac{3}{2}}}
       {\mathrm{e}}^{{\mathrm{i}}\frac{\omega}{c}|\x_0-\xs|}

for the 2.5D case. For the temporal domain, inverse Fourier transform yields the
driving signals

.. math::
    :label: d.localwfs

    d(\x_0,t) = \sum_{{\x_\text{fs}}\in \mathcal{X}_{\mathrm{fs}}} 
        d_{\mathrm l}({\x_\text{fs}}, t) * 
        d_{\mathrm{fs}}(\x_0,{\x_\text{fs}}, t) \;,

while :math:`d_{\mathrm{fs}}(\x_0,{\x_\text{fs}}, t)` is derived analogously to
from or . At the moment :math:`d_{\mathrm l}({\x_\text{fs}}, t)` does only
support driving functions from |WFS|.

.. vim: filetype=rst spell:
